apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: search-learn-to-rank-lightgbm-regression-train-
spec:
  entrypoint: search-learn-to-rank-lightgbm-regression-train
  templates:
    - name: search-learn-to-rank-lightgbm-regression-train
      container:
        image: shibui/building-ml-system:ai_animals_search_learn_to_rank_train_0.0.0
        imagePullPolicy: Always
        command:
          - "python"
          - "-m"
          - "src.main"
        env:
          - name: MODEL_CONFIG
            value: learn_to_rank_lightgbm_regression
          - name: MLFLOW_TRACKING_URI
            value: http://mlflow.mlflow.svc.cluster.local:5000
          - name: MLFLOW_EXPERIMENT
            value: search_learn_to_rank
          - name: POSTGRES_HOST
            value: postgres.data.svc.cluster.local
          - name: POSTGRES_PORT
            value: "5432"
          - name: POSTGRES_USER
            value: postgres
          - name: POSTGRES_PASSWORD
            value: password
          - name: POSTGRES_DB
            value: aianimals
          - name: REDIS_HOST
            value: redis.data.svc.cluster.local
          - name: REDIS_PORT
            value: "6379"
          - name: REDIS_DB
            value: "0"
          - name: FEATURE_MLFLOW_EXPERIMENT_ID
            value: "2"
          - name: FEATURE_MLFLOW_RUN_ID
            value: ""
        resources:
          limits:
            cpu: 2000m
            memory: "8000Mi"
          requests:
            cpu: 2000m
            memory: "4000Mi"
  imagePullSecrets:
    - name: regcred
